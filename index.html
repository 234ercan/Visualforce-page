<!--Login and Registration page - used for mobile app-->
<apex:page controller="DCG_MobileLoginController" docType="html-5.0" showHeader="false" sidebar="false" standardStylesheets="false">
    
    <!--get Bootstrap library-->
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="description" content=""/>
        <meta name="author" content=""/>
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;500;600;700;800&display=swap" rel="stylesheet" />
        <!--link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Poppins:wght@300;500&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Serif+Display&display=swap" rel="stylesheet" />
        <link href="(https://fonts.googleapis.com/css?family=Montserrat:300,500,600,700,800&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Poppins:wght@300;500&display=swap" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Serif+Display&display=swap" rel="stylesheet" /-->
        
        <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" />
        <apex:stylesheet value="{!URLFOR($Resource.bootstrap, '/bootstrap-4.6.0-dist/css/bootstrap.min.css')}" />           
        <apex:includeScript value="{!URLFOR($Resource.bootstrap, 'bootstrap-4.6.0-dist/js/bootstrap.min.js')}"/>
    </head>
    
    <!--generic stylesheet-->
    <apex:stylesheet value="{!URLFOR($Resource.tastecardMobile,'/tastecardMobile/GeneralStyle.css')}"/>
    
    <script>
    //setup jquery 
    j$ = jQuery.noConflict();
    var emailAddress;
    var firstName;
    var lastName;
    var pin;
    var markPref;
    
    //add listeners after ajax call
    function addListeners(){
        j$('#Email').val(emailAddress);
        j$('#email3').val(emailAddress);
        j$('#firstName').val(firstName);
        j$('#lastName').val(lastName);
        j$('#pin').val(pin);
        j$('#markPref input:radio:checked').val(markPref);
        
        j$(".js-toggle-password").click(function(event) {
            var input = j$(event.target).parent('.form-input').find('input');
            j$(this).toggleClass("fa-eye fa-eye-slash");  
            if (input.attr("type") == "password") {
                input.attr("type", "text");
            } else {
                input.attr("type", "password");
            }
        }); 
        
        j$( document ).ready(function() {
            setStyleSheet(false);
            [...document.querySelectorAll('.js-form-validate')].forEach((el) => {
                j$('input, textarea, select', j$(el)).off('blur.forms focus.forms click.forms focusin.forms focusout.forms').on('blur.forms focus.forms click.forms focusin.forms focusout.forms', handleFocusBlur); // ,validateInputWithClickError
            });
                
                j$('.js-form-validate').find('input:not([type=button]):not([type=checkbox]):not([type=radio]), textarea, select')
                .filter((index, element) => Boolean(j$(element).next('label').length))
                .each((index, element) => handleHasValueState(element));                    
            });                    
            }
                
                function handleHasValueState(element, parentElement) {
                j$(parentElement || element.closest('.form-group') || element.parentElement)
                .toggleClass('has-value', Boolean(element.value));          
            }
                
                // called when focusing and blur out on all fields 
                function handleFocusBlur(event) {
                const element = event.currentTarget;
                const parentElement = element.closest('.form-group');
                if (element.getAttribute('type') === 'checkbox' || element.getAttribute('type') === 'radio') {
                if (event.type === 'click') {
                return true;
            }
            }
                
                if (event.type === "focus") {
                resetFormGroupClassName(parentElement);
            }
                
                if (event.type === "blur") {             
                checkValidity(element, parentElement);
            }
            }
                
                function resetFormGroupClassName(parentElement) {
                const cssErrorTypes = [
                "error-invalid",
                "error-typeMismatch",
                "error-patternMismatch",
                "error-invalidEmail",
                "error-valueMissing",
                "error-tooShort",
                "error-invalidCode",
                "error-valueMismatch",
                "has-value",
                "is-valid",
                ];
                if(!parentElement) return;
                
                // IE cant handle array as param or mulitple in one call
                [...cssErrorTypes].forEach(item => {
                parentElement.classList.remove(item);
            });
            }
                
                function checkValidity(element, parentElement) {
                
                let isValid = true;
                for (let key in element.validity) {
                if (element.validity[key] && key != 'valid') {
                parentElement.classList.add(`error-${key}`);
                isValid = false;
            }
            }
                
                
                if(element.id.includes("Reg"))
                {
                // check if the passwords entered are populated and match                     
                if(element.type == 'password')
                {
                var password = document.getElementById('pwdReg');
                var confirmPassword = document.getElementById('confirmPasswordReg');
                if (password.value && confirmPassword.value)
                {
                if (password.value == confirmPassword.value)
                {
                password.closest('.form-group').classList.remove(`error-mismatch`);
                confirmPassword.closest('.form-group').classList.remove(`error-mismatch`);
                isValid = true;                         
            } else {
                password.closest('.form-group').classList.add(`error-mismatch`);
                confirmPassword.closest('.form-group').classList.add(`error-mismatch`);
                isValid = false;
            }
            }
            }
            }
                
                
                if (element.validity.valid && element.hasAttribute('required')) {
                parentElement.classList.add(`is-valid`);
            }
                
                if (element.value) {
                parentElement.classList.add('has-value');
            }
                
                for (let key in element.validity) { // reset all to cover our custom invalidCode check
                element.validity[key] = ''
            }
                
                return isValid;
            }
                
                function handleSubmit(form) {
                let canSubmit = true;
                
                j$(form).find('input, textarea, select').not(':input[type=button], :input[type=submit]').each(function (idx, el) {
                if (el.type === 'hidden') {
                return;
            }
                
                const parentElement = el.closest('.form-group');
                let isElementValid = checkValidity(el, parentElement);
                
                if (!isElementValid) {
                canSubmit = false;
            }
            }.bind(this));
                if (canSubmit) {
                return true;
            }
                return false;
            }
                
                //validate login email            
                function validateEmail(event) {
                event.preventDefault();
                const element = event.currentTarget;
                const parentElement = element.closest('form');
                if(handleSubmit(parentElement)) {
                emailAddress = j$('#email2').val();
                checkCustomerStatus(emailAddress);
            }
            }
                
                //validate login password
                function validatePassword(event) {
                event.preventDefault();
                const element = event.currentTarget;
                const parentElement = element.closest('form');
                if(handleSubmit(parentElement)) {
                var pwd = j$('#pwd').val();
                login(pwd);
            }
            }
                
                //reset password
                function resetPasswordJs(event) {
                event.preventDefault();
                const element = event.currentTarget;
                const parentElement = element.closest('form');
                if(handleSubmit(parentElement)) {
                var email = j$('#email3').val();
                resetPass(email);
            }
            }
                
                //register the user
                function registerUser(){
                event.preventDefault();
                const element = event.currentTarget;
                const parentElement = element.closest('form');
                if(handleSubmit(parentElement)) {
                markPref = j$('#markPref input:radio:checked').val();
                var optInAuthorisation = j$('#optinAuthorisation').is(":checked");
                var markPrefBool = false;
                if(markPref == "true"){
                markPrefBool = true;
            }
                //get reg fields
                firstName = j$('#firstName').val();
                lastName = j$('#lastName').val();
                emailAddress = j$('#Email').val();
                pin = j$('#pin').val();
                var pwd = j$('#pwdReg').val();
                var cPwd = j$('#confirmPasswordReg').val();
                
                //register or activate the user
                registerOrActivate(firstName, lastName, emailAddress, pin, pwd, cPwd, markPrefBool, optInAuthorisation);
            }
                /**if(handleSubmit(parentElement)) {
                var firstName = j$('#firstName').val();
               
            }
            if(handleSubmit(parentElement)) {
                var lastName = j$('#lastName').val();
                
            }
             if(handleSubmit(parentElement)) {
                var emailAddress = j$('#Email').val();
               
            }**/
                
            }
                
                //home
                function backToHomeJS(event) {
                event.preventDefault();            
                backToHome();
                j$('.img-logo').hide();
                setStyleSheet(true);
            }
                
                function setStyleSheet(flag) {            
                var classes = document.getElementById("pageContainer").className;
                var currentTheme = classes.split(" ").pop() + "Theme";
                for (let i = 0; i < document.styleSheets.length; i++) {
                let styleSheet = document.styleSheets[i];               
                if (styleSheet.href.includes(currentTheme)) {
                styleSheet.disabled = flag;
            }
            }
            }
                
                //set quote fields promise
                function createCustomerPromise(firstName, lastName, email){
                return new Promise( function (resolve, reject){
                Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.DCG_MobileLoginController.createCustomer}',
                firstName, lastName, email,
                function(response, event){
                if(event.statusCode == '200'){
                resolve(response);
            }
                else{
                reject();
            }
            });
            });
            }
                
                //send to Zuora
                function registerOrActivate(firstName, lastName, emailAddress, pin, pwd, cPwd, markPrefBool, optInAuthorisation){
                j$('[id$=spinner]').show();
                
                //if there is an activation code then create customer in a separate transaction before making the API call
                if(pin){
                //populate quote fields
                var createCust = createCustomerPromise(firstName, lastName, emailAddress);
                createCust.then(result => {
                //call Apex register user
                regUser(firstName, lastName, emailAddress, pin, pwd, cPwd, markPrefBool, optInAuthorisation);
                j$('[id$=spinner]').hide();
            })
                .catch(error => {
                console.log('Error: ' + error);
            });
            }
                else{
                //call Apex register user
                regUser(firstName, lastName, emailAddress, pin, pwd, cPwd, markPrefBool, optInAuthorisation);
            }
            }
                
                //pass in sub brand e.g. Natwest or RBS for activation page
                function showActivationPage(subBrand){
                showActivation(subBrand);
            }
                </script>
    
    <!--Login form-->
    <apex:outputPanel id="wholepage">
        
        <!--Add the theme stylesheet - default to tastecardStyle.css - NW/RBS specific stylesheet inside render -->
        <apex:stylesheet value="{!URLFOR($Resource[theme + 'Theme'], 'Theme/Style.css')}"/>
        
        <div id="pageContainer" class="container-fluid no-mr-pd {!theme}">
            <div class="row no-gutters full-height">
                <div class="col-12">
                    <!--Show Home Page-->
                    <apex:outputPanel rendered="{!showHomeScreen}" id="homeP">
                        <apex:form html-novalidate="" styleClass="form-horizontal needs-validation full-height">
                            <div class="wrapper-container js-form-validate full-height">
                                <div class="wrapper-background full-height">
                                    
                                    <!--claim -->
                                    <div class="login-claim">
                                        <h2 class="main-header">Welcome to tastecard.</h2>
                                    </div>
                                    
                                    <!-- Image Card -->
                                    <div class="card-center">
                                        <apex:image url="{!$Resource.tastecardBgForCard}" styleClass="img-bg full-height"/>
                                        <apex:image url="{!$Resource.tastecardCard}" styleClass="img-card"/>
                                    </div>
                                    
                                    <!-- Login Button Claim -->
                                    <div>
                                        <p>Got a membership number?</p>
                                    </div>
                                    
                                    <!--Login button-->
                                    <div class="form-group row justify-content-center">
                                        <div class="col-12 col-sm-7">
                                            <apex:commandButton action="{!showChechCustomerStatus}" styleClass="btn btn-cta btn-success btn-block" value="LOG IN" reRender="wholepage" oncomplete="addListeners()"/>
                                        </div>
                                    </div>
                                    
                                    <!--Get Started button-->
                                    <div class="form-group row justify-content-center">
                                        <div class="col-12 col-sm-7">
                                            <apex:commandButton action="{!getStarted}" styleClass="btn btn-cta btn-tertiary btn-block" value="TRY TASTECARD" reRender="wholepage" oncomplete="addListeners()"/>
                                        </div>
                                    </div> 
                                    
                                    <!--Activate Membership Button & Links-->
                                    <div class="form-group row justify-content-center">
                                        <div class="col-12 col-sm-7">
                                            <p>Got a Redemption Code or PIN?</p>
                                            <div class="activate-membership"> 
                                                <apex:commandButton action="{!showActivationPage}" styleClass="btn btn-cta btn-tertiary btn-block" value="ACTIVATE MEMBERSHIP" reRender="wholepage" oncomplete="addListeners()"/>
                                            </div>
                                            
                                            <div class="activate-membership activate-membership-eb mt-4">
                                                <p>
                                                    Activate an 
                                                    <a onclick="showActivationPage('RBS')" href="#">RBS</a> 
                                                    or 
                                                    <a onclick="showActivationPage('Natwest')" href="#">Natwest</a> 
                                                    card
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </apex:form>
                    </apex:outputPanel>
                    
                    <!--Show back home button and logo-->
                    <div class="wrapper-container js-form-validate">
                        
                        <apex:outputPanel rendered="{! !showHomeScreen}">
                            <apex:form >
                                <header class="header">
                                    <div class="row">
                                        <div class="col-12">
                                            <!--Back to login button-->
                                            <button onclick="backToHomeJS(event)" class="btn btn-back"><apex:image url="{!$Resource.tastecardBack}" styleClass="img-back"/></button>
                                            
                                            <!--logo -->
                                            <div class="logo-center mt-2">
                                                <apex:image value="{!URLFOR($Resource[theme + 'Theme'], 'Theme/Logo.png')}" styleClass="img-logo"/>
                                            </div> 
                                        </div>
                                    </div>
                                </header>
                            </apex:form>
                        </apex:outputPanel>
                        
                        <!--Error Message-->
                        <apex:outputPanel id="theError" rendered="{!AND(errorMsg != '', errorMsg != null)}">
                            <div class="mt-2 mb-4 text-danger text-atted text-formatted">
                                {!errorMsg}
                            </div>
                        </apex:outputPanel>
                        
                        <!--Success Message-->
                        <apex:outputPanel id="theSuccess" rendered="{!AND(successMsg != '', successMsg != null)}">
                            <div class="mt-2 mb-4 text-formatted">
                                {!successMsg}
                            </div>
                        </apex:outputPanel>
                        
                        <!--Show Check Customer Status page Page-->
                        <apex:outputPanel rendered="{!showCustomerStatus}" id="checkCustP">
                            <apex:form html-novalidate="" styleClass="form-horizontal needs-validation">
                                <div class="row">
                                    <div class="col-12">
                                        <h3>Enter your email address.</h3>
                                        <p class="subtitle-login">Use the email address you signed up with.</p>
                                    </div>
                                </div>
                                <!--Email-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <div class="form-input">
                                            <input type="email" required="true" class="form-control" id="email2" html-autocomplete="off" html-placeholder=""/>
                                            <label for="email2">Email Address*</label>
                                        </div>
                                        <div class="form-help">
                                            <small class="form-text text-danger" data-hint-rule="short">A bit too short, sorry</small>
                                            <small class="form-text text-danger" data-hint-rule="empty">Please enter some text!</small>
                                            <small class="form-text text-danger" data-hint-rule="email">Please enter a valid email!</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!--login button-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <button onclick="validateEmail(event);" class="btn btn-cta btn-success btn-block js-next" oncomplete="addListeners()">Next</button>
                                    </div>
                                </div>
                                
                                <!--Activate Membership Link-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <div class="activate-membership"> 
                                            <p>Got a redemption code or PIN?</p>
                                            <a onclick="showActivation()" href="#">Activate your membership</a>
                                        </div>
                                    </div>
                                </div>
                            </apex:form>
                        </apex:outputPanel>
                        <!--END - Show Check Customer Status page Page-->
                        
                        <!--Show Login Page-->
                        <apex:outputPanel rendered="{!showLogin}" id="loginP">
                            <apex:form html-novalidate="" styleClass="form-horizontal needs-validation">
                                <div class="row">
                                    <div class="col-12">
                                        <h3>{!loginMessage}</h3>
                                        <p class="subtitle-login">
                                            Use the password you created after signing up.
                                        </p>
                                    </div>
                                </div>
                                
                                <!--password-->
                                <div class="form-group input-password pw-eye row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <div class="form-input with-icon-eye">
                                            <input type="password" required="true" class="form-control" id="pwd" placeholder=""/>
                                            <label for="pwd">Password*</label>
                                            <span toggle="#pwdReg" class="fa fa-fw fa-eye field-icon-eye js-toggle-password"></span>
                                        </div>
                                        <div class="form-help">
                                            <small class="form-text text-danger" data-hint-rule="empty">Please enter some text !</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!--Forgot Password Link-->
                                <div class="row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <apex:outputPanel rendered="{! !showReset}">
                                            <apex:commandLink action="{!showResetPage}" styleClass="btn btn-link btn-block forgot-password-link" value="Forgotten password?" reRender="wholepage"/>
                                        </apex:outputPanel>
                                    </div>
                                </div>
                                
                                <!--login button-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <button onclick="validatePassword(event);" class="btn btn-cta btn-success btn-block">Login</button>
                                    </div>
                                </div>
                            </apex:form>
                        </apex:outputPanel>
                        
                        <!--Show Password Reset Page-->
                        <apex:outputPanel rendered="{!showReset}" id="resetP">
                            <apex:form html-novalidate="" styleClass="form-horizontal needs-validation ">
                                <div class="row">
                                    <div class="col-12">
                                        <h3>You need to reset your password</h3>
                                        <p class="subtitle-login">To keep your account secure you need to reset your password</p>
                                    </div>
                                </div>
                                
                                <!--email - might be populated already-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <div class="form-input">
                                            <input type="email" required="true" class="form-control" id="email3" html-autocomplete="off" html-placeholder=""/>
                                            <label for="email3">Email Address*</label>
                                        </div>
                                        <div class="form-help">
                                            <small class="form-text text-danger" data-hint-rule="short">A bit too short, sorry</small>
                                            <small class="form-text text-danger" data-hint-rule="empty">Please enter some text !</small>
                                            <small class="form-text text-danger" data-hint-rule="email">Please enter a valid email!</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!--Reset Password button-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <button onclick="resetPasswordJs(event);" class="btn btn-cta btn-success btn-bloc">RESET PASSWORD</button>
                                    </div>
                                </div>
                            </apex:form>
                        </apex:outputPanel>
                        
                        <!--Show Registation page-->
                        <apex:outputPanel rendered="{!showReg}" id="regP">
                            <apex:form html-novalidate="" styleClass="form-horizontal needs-validation ">
                                <div class="create-account">
                                    <div class="form-group row justify-content-center">
                                        <div class="col-12 col-sm-7">
                                            <h3>{!registrationHeader}</h3>
                                            <p class="subtitle">{!registrationSubHeader}</p>
                                            <apex:outputPanel rendered="{!IF(subBrand == '' , false , true)}" id="emailMessage">
                                                <p class="subtitle"><b>{!$Label[theme + 'EmailMessage']}</b></p>
                                            </apex:outputPanel>
                                        </div>
                                    </div>
                                    
                                    <apex:outputPanel rendered="{!showNames}" id="namesP">
                                        <!--First name-->
                                        <div class="form-group row justify-content-center">
                                            <div class="col-12 col-sm-7">
                                                <div class="form-input">
                                                    <input type="text" class="required form-control" id="firstName" html-autocomplete="off" required="true" html-placeholder=""/>
                                                    <label  for="firstName">First Name*</label>
                                                </div>
                                                <div class="form-help">
                                                    <small class="form-text text-danger" data-hint-rule="short">A bit too short, sorry</small>
                                                    <small class="form-text text-danger" data-hint-rule="empty">Please enter some text</small>
                                                </div>
                                            </div> 
                                        </div> 
                                        
                                        <!--Last name-->
                                        <div class="form-group row justify-content-center">
                                            <div class="col-12 col-sm-7">
                                                <div class="form-input">
                                                    <input type="text" class="required form-control" id="lastName" html-autocomplete="off" required="true" html-placeholder=""/>
                                                    <label  for="lastName">Last Name*</label>
                                                </div>
                                                <div class="form-help">
                                                    <small class="form-text text-danger" data-hint-rule="short">A bit too short, sorry</small>
                                                    <small class="form-text text-danger" data-hint-rule="empty">Please enter some text</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!--Email-->
                                        <div class="form-group row justify-content-center">
                                            <div class="col-12 col-sm-7">
                                                <div class="form-input">
                                                    <input type="email" class="required form-control" id="Email" html-autocomplete="off" required="true" html-placeholder=""/>
                                                    <label for="Email">Email*</label>
                                                </div>
                                                <div class="form-help">
                                                    <small class="form-text text-danger" data-hint-rule="short">A bit too short, sorry</small>
                                                    <small class="form-text text-danger" data-hint-rule="empty">Please enter some text</small>
                                                    <small class="form-text text-danger" data-hint-rule="email">Please enter a valid email</small>
                                                </div>
                                            </div>  
                                        </div>
                                    </apex:outputPanel>
                                    
                                    <!--Redemptioncode/Membership number-->
                                    <apex:outputPanel rendered="{!isActivation}" id="pinP">
                                        <div class="form-group row justify-content-center">
                                            <div class="col-12 col-sm-7">
                                                <div class="form-input">
                                                    <input type="text" class="required form-control" id="pin" html-autocomplete="off" required="true" html-placeholder=""/>
                                                    <label for="pin">Redemption Code*</label>
                                                </div> 
                                                <div class="form-help">
                                                    <small class="form-text text-danger" data-hint-rule="short">A bit too short, sorry</small>
                                                    <small class="form-text text-danger" data-hint-rule="empty">Please enter some text</small>
                                                </div>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    
                                    <!--Create password-->
                                    <div class="form-group row pw-eye justify-content-center">
                                        <div class="col-12 col-sm-7">
                                            <div class="additional-legend-input">
                                                Already have a tastecard account? You’ll need to remember your old password
                                            </div>
                                            <div class="form-input with-icon-eye">
                                                <input type="password" required="true" class="form-control" id="pwdReg" placeholder="" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*(){}[\]<>?\/|.:;_-]).{8,}"/>
                                                <label for="pwdReg">Create Password*</label> 
                                                <span toggle="#pwdReg"  class="field-icon-eye fa fa-fw fa-eye js-toggle-password"></span>
                                            </div>
                                            <div class="form-help">
                                                <small class="form-text text-danger" data-hint-rule="empty">Please enter some text</small>
                                                <small class="form-text text-danger" data-hint-rule="mismatch">Passwords do not match</small>
                                                <small class="form-text text-danger" data-hint-rule="patternMismatch">Password does not meet requirement</small>
                                            </div>
                                            <div class="legend-input">
                                                Must be at least 8 characters, include numbers, uppercase, and lowercase letters, and at least one special character.
                                            </div>
                                        </div>
                                    </div>
                                    <!--confirm password-->
                                    <div class="form-group row pw-eye justify-content-center">
                                        <div class="col-12 col-sm-7">    
                                            <div class="form-input with-icon-eye">
                                                <input type="password" required="true" class="form-control" id="confirmPasswordReg" placeholder="" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*(){}[\]<>?\/|.:;_-]).{8,}"/>
                                                <label for="confirmPasswordReg">Confirm Password*</label>
                                                <span toggle="#pwdReg" class="fa fa-fw fa-eye field-icon-eye js-toggle-password"></span>
                                            </div>
                                            <div class="form-help">
                                                <small class="form-text text-danger" data-hint-rule="empty">Please enter some text</small>
                                                <small class="form-text text-danger" data-hint-rule="mismatch">Passwords do not match</small>
                                                <small class="form-text text-danger" data-hint-rule="patternMismatch">Password does not meet requirement</small>
                                            </div>
                                        </div>
                                    </div>
                                    <!--T&Cs-->
                                    <apex:outputPanel rendered="{!showTandCs}" id="tandcP">
                                        <div class="form-group row justify-content-center">
                                            <div class="col-12 col-sm-7">
                                                <div class="wrapper-text">
                                                    
                                                    <div class="form-check custom-control custom-checkbox">
                                                        <input type="checkbox" required="true" class="form-check-input custom-control-input" id="optinAuthorisation" />
                                                        <label class="form-check-label custom-control-label" for="optinAuthorisation">By continuing you acknowledge that you have read and agree to the full <a onclick="showTerms()" href="#" class="btn-link">Terms and Conditions</a> of Tastecard membership</label>
                                                    </div>
                                                    <div class="form-help">
                                                        <small class="form-text text-danger" data-hint-rule="empty">Please select checkbox</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    <!--Marketing Checkbox-->
                                    <div class="form-group row justify-content-center" id="markPref">
                                        <div class="col-12 col-sm-7">
                                            <div class="form-help">
                                                <small class="form-text text-danger" data-hint-rule="empty">Please select option</small>
                                            </div>
                                            <div class="wrapper-text">
                                                <label class="form-check-label" for="market">{!$Label.DCG_MobileMarketingText}</label>
                                                <div class="row">
                                                    <div class="col-auto"> 
                                                        <div class="form-check custom-control custom-radio">
                                                            <input required="true" class="form-check-input custom-control-input" type="radio" name="marketingPrefs" id="yesRadio" value="true"/>
                                                            <label class="form-check-label custom-control-label" for="yesRadio">
                                                                Yes, sign me up
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <div class="col-auto">
                                                        <div class="form-check custom-control custom-radio">
                                                            <input required="true" class="form-check-input custom-control-input" type="radio" name="marketingPrefs" id="noRadio" value="false"/>
                                                            <label class="form-check-label custom-control-label" for="noRadio">
                                                                No thanks, I don't want any updates
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div> 
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!--Register User button-->
                                    <div class="form-group row justify-content-center">
                                        <div class="col-12 col-sm-7">
                                            <button class="btn btn-cta btn-success btn-block" onclick="registerUser()">Continue</button>
                                        </div>
                                    </div>
                                    <!--privacy policy -->
                                    <div class="form-group row text-left">
                                        <div class="col-12 col-sm-7">
                                            <label class="form-privacy-policy-label" for="privacy">Read our <a onclick="showPrivacy()" href="#" class="btn-link">Privacy Policy</a></label>
                                        </div> 
                                    </div>
                                    
                                </div>
                            </apex:form>
                        </apex:outputPanel>
                        
                        <!-- Commenting out the sub components for the privacy and terms pages Privacy policy page-->
                        <apex:outputPanel rendered="{!showPrivacyScreen}" id="privacyP">
                            <div class='align-left'>
                                <c:tastecardPrivacyPolicy ></c:tastecardPrivacyPolicy>
                            </div>
                        </apex:outputPanel>
                        
                        <!-- Ts&Cs page -->
                        <apex:outputPanel rendered="{!showTermsScreen}" id="termsP">
                            <div class='align-left'>
                                <c:tastecardTermsAndConditions ></c:tastecardTermsAndConditions>
                            </div>
                        </apex:outputPanel>
                        
                        <!--Confirm Login-->
                        <apex:outputPanel rendered="{!showRegLogin}">
                            <apex:form html-novalidate="" styleClass="form-horizontal needs-validation">
                                <!--login after registation button-->
                                <div class="form-group row justify-content-center">
                                    <div class="col-12 col-sm-7">
                                        <apex:commandButton action="{!login}" styleClass="btn btn-cta btn-success btn-block" value="Confirm Login"/>
                                    </div>
                                </div>
                            </apex:form>
                        </apex:outputPanel>
                    </div>
                </div>
            </div>
        </div> <!-- /container-fluid -->
        
        
        <div  id="spinner" class="spinnerContainer hidden">
            <div class="d-flex justify-content-center align-items-center">
                <div class="spinner-border" role="status">
                    <span class="sr-only">Loading...</span>
                </div> 
            </div>
        </div>
        
        <!--spinner-->
        <apex:actionStatus id="status">
            <apex:facet name="start">
                <div class="spinnerContainer">
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="spinner-border" role="status">
                            <span class="sr-only">Loading...</span>
                        </div> 
                    </div>
                </div>
            </apex:facet>
        </apex:actionStatus>
        
        <!--Action functions - call Apex from JS-->
        <apex:form >
            <apex:actionFunction name="checkCustomerStatus" action="{!checkCustomerStatus}" rerender="wholepage" status="status" oncomplete="addListeners()">
                <apex:param name="email" assignTo="{!email}" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="resetPass" action="{!resetPassword}" rerender="wholepage" status="status" oncomplete="addListeners()">
                <apex:param name="email" assignTo="{!email}" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="login" action="{!login}" rerender="wholepage" status="status" oncomplete="addListeners()">
                <apex:param name="pwd" assignTo="{!password}" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="showActivation" action="{!showActivationPage}" rerender="wholepage" status="status" oncomplete="addListeners()">
                <apex:param name="subBrand" assignTo="{!subBrand}" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="regUser" action="{!registerOrActivateUser}" rerender="wholepage" status="status" oncomplete="addListeners()">
                <apex:param name="firstName" assignTo="{!firstName}" value=""/>
                <apex:param name="lastName" assignTo="{!lastName}" value=""/>
                <apex:param name="email" assignTo="{!email}" value=""/>
                <apex:param name="pin" assignTo="{!pin}" value=""/>
                <apex:param name="pass" assignTo="{!password}" value=""/>
                <apex:param name="confPass" assignTo="{!confirmPassword}" value=""/>
                <apex:param name="markPref" assignTo="{!marketingOptIn}" value=""/>
                <apex:param name="optInAuthorisation" assignTo="{!termsAndCs}" value=""/>
            </apex:actionFunction>
            <apex:actionFunction name="backToHome" action="{!showHome}" status="status" rerender="wholepage"/>
            <apex:actionFunction name="showPrivacy" action="{!showPrivacy}" status="status" rerender="wholepage"/>
            <apex:actionFunction name="showTerms" action="{!showTerms}" status="status" rerender="wholepage"/>
        </apex:form>
    </apex:outputPanel>
</apex:page>